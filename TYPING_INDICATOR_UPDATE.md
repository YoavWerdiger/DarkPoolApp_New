# ✍️ עדכון Typing Indicator

## מה השתנה? 🔄

שיפרתי את ה-typing indicator כך ש**כל שינוי בטקסט** מפעיל אותו, לא רק כשמתחילים או מפסיקים להקליד.

---

## איך זה עובד עכשיו? ⚙️

### Throttling (מניעת ספאם)

במקום לשלוח עדכון על **כל אות**, השירות משתמש ב-**throttling**:

```typescript
// שולח עדכון רק אחת ל-500ms
if (timeSinceLastTyping > 500) {
  startTyping();
  lastTypingTimeRef.current = now;
}
```

**למה?**
- אם נשלח עדכון על כל אות, זה ייצור עומס על Supabase
- 500ms = 2 אותיות בשנייה = מאוד מהיר ועדיין יעיל

---

### Auto-Stop (עצירה אוטומטית)

אם המשתמש מפסיק להקליד ל-2 שניות, הסטטוס מתאפס:

```typescript
// אם לא מקלידים 2 שניות, נפסיק
setTimeout(() => {
  stopTyping();
  setIsTyping(false);
}, 2000);
```

**זה אומר:**
- מקלידים → "מקליד..." מופיע
- עוצרים 2 שניות → "מקליד..." נעלם
- ממשיכים → "מקליד..." חזר

---

## ההבדל בין הגרסה הקודמת לנוכחית:

### ❌ גרסה קודמת:
```
התחל להקליד → "מקליד..." מופיע
מחק הכל → "מקליד..." נעלם
רק 2 מצבים: מקליד או לא
```

### ✅ גרסה חדשה:
```
כל שינוי בטקסט → "מקליד..." מופיע
(throttled ל-500ms)

לא מקלידים 2 שניות → "מקליד..." נעלם
(auto-timeout)

עובד על כל שינוי בתוכן!
```

---

## הגדרות שאפשר לשנות:

### 1. Throttle Time (כמה זמן בין עדכונים):

ב-`MessageInputBar.tsx`, שורה ~176:

```typescript
if (timeSinceLastTyping > 500) { // <-- שנה כאן
  startTyping?.();
  ...
}
```

**אופציות:**
- `300` = עדכון כל 0.3 שניות (יותר תכוף)
- `500` = עדכון כל 0.5 שניות (מומלץ)
- `1000` = עדכון כל שנייה (פחות תכוף)

### 2. Auto-Stop Time (כמה זמן עד שנפסיק):

ב-`MessageInputBar.tsx`, שורה ~190:

```typescript
setTimeout(() => {
  stopTyping?.();
  setIsTyping(false);
}, 2000); // <-- שנה כאן
```

**אופציות:**
- `1000` = עצירה אחרי שנייה
- `2000` = עצירה אחרי שתיים (מומלץ)
- `3000` = עצירה אחרי 3 שניות

---

## דוגמה למה שקורה:

```
שעה 10:00:00.000 - כותב "ש"
  → startTyping() (ראשונה)

שעה 10:00:00.100 - כותב "של"
  → לא שולח (עברו רק 100ms)

שעה 10:00:00.600 - כותב "שלו"
  → startTyping() (עברו 600ms)

שעה 10:00:02.600 - לא כותב כלום
  → stopTyping() (עברו 2 שניות)
```

---

## ביצועים 🚀

### לפני (ללא throttling):
```
100 אותיות = 100 presence updates 😱
```

### עכשיו (עם throttling):
```
100 אותיות ב-10 שניות = ~20 presence updates 😊
(עדכון כל 500ms)
```

**חיסכון של 80% בטראפיק!**

---

## בדיקה 🧪

1. **פתח Console**
2. **תתחיל להקליד**
3. **צפה בלוגים:**

```
✍️ MessageInputBar: User typing (throttled)
[500ms חלפו]
✍️ MessageInputBar: User typing (throttled)
[תפסיק להקליד 2 שניות]
🛑 MessageInputBar: User stopped typing (timeout)
```

---

## שאלות נפוצות ❓

### למה 500ms?
מספיק מהיר כדי להרגיש real-time, אבל לא מטורף.

### למה 2 שניות timeout?
זה הזמן הסטנדרטי בווטסאפ וטלגרם.

### אפשר לשנות?
כן! ראה "הגדרות שאפשר לשנות" למעלה.

---

**עכשיו זה עובד על כל שינוי בטקסט!** 🎉

